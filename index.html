<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Christbahndl Speise- und Getränkekarte</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .container {
      display: flex;
      flex-direction: row;
    }

    .menu {
      flex: 2;
      padding-right: 33.33%;
      /* 1/3 of the container's width */
    }

    .menu-section {
      display: flex;
      flex-wrap: wrap;
      justify-content: start;
    }

    .total {
      position: fixed;
      top: 0;
      right: 0;
      width: 33.33%;
      height: 100%;
      overflow: hidden;
      background: rgba(224, 255, 255, 0.466);
    }

    .total-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #totalPrice {
      font-size: 24px;
      font-weight: bold;
    }

    .fixed-total {
      z-index: 1;
    }

    .scrollable-items {
      overflow-y: auto;
      height: calc(100% - 160px);
      /* Adjust this value */
    }

    .button {
      flex: 1;
      padding: 10px;
      margin: 5px;
      text-align: center;
      font-size: 16px;
    }

    .selected-item {
      display: flex;
      justify-content: space-between;
      margin: 5px;
      padding: 5px;
      border: 1px solid #ccc;
      cursor: pointer;
    }

    .reset-button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    
  </style>
</head>

<body>

  <div class="container">
    <div class="menu" id="menuDiv">
      <!-- Menu items will be populated here -->
    </div>

    <div class="total">
      <div class="fixed-total">
        <button id="resetButtonTop" class="reset-button">Zurücksetzen</button>
        <div id="totalWrapper" class="total-wrapper">
          <h3>Gesamt:</h3>
          <span id="totalPrice">€0</span>
        </div>
      </div>
      <div class="scrollable-items" id="selectedItems"></div>
      <button id="resetButtonBottom" class="reset-button">Zurücksetzen</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>

  <script>
    let selectedItems = {};
    let totalPrice = 0;

    // Fetch menu items from JSON file
    const url = 'https://raw.githubusercontent.com/marcodipanfilo/Christbahnl/fetch_data_json/menu.json';  // Update this to your actual URL
    fetch(url)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        const menuDiv = document.getElementById('menuDiv');
        menuDiv.innerHTML = '';  // Clear existing menu if needed

        // Loop through each category in the fetched menu
        data.menu.forEach(category => {
          const categoryTitle = document.createElement('h2');
          categoryTitle.textContent = category.category;
          menuDiv.appendChild(categoryTitle);

          const menuSection = document.createElement('div');
          menuSection.className = 'menu-section';

          // Sort items within each category by name
          category.items.sort((a, b) => {
            return a.name.localeCompare(b.name);
          });

          // Loop through each item in the sorted category
          category.items.forEach(item => {
            const button = document.createElement('button');
            button.className = 'button';
            button.dataset.name = item.name;
            button.dataset.price = item.price;
            button.textContent = `${item.name} €${item.price}`;
            button.addEventListener('click', handleButtonClick);
            menuSection.appendChild(button);
          });

          menuDiv.appendChild(menuSection);
        });
      })
      .catch(error => {
        console.log('Fetch problem: ', error);
      });

    function handleButtonClick() {
      const itemName = this.getAttribute('data-name');
      const itemPrice = parseFloat(this.getAttribute('data-price'));

      totalPrice += itemPrice;

      if (selectedItems[itemName]) {
        selectedItems[itemName].count++;
      } else {
        selectedItems[itemName] = { count: 1, itemPrice: itemPrice };
      }

      updateUI();
    }

    function updateUI() {
      const selectedItemsDiv = document.getElementById('selectedItems');
      const totalPriceDiv = document.getElementById('totalPrice');

      selectedItemsDiv.innerHTML = '';

      for (const [itemName, itemInfo] of Object.entries(selectedItems)) {
        const div = document.createElement('div');
        div.className = 'selected-item';
        div.innerHTML = `${itemName} x${itemInfo.count} <span>-</span>`;
        div.addEventListener('click', function () {
          itemInfo.count--;
          totalPrice -= itemInfo.itemPrice;

          if (itemInfo.count === 0) {
            delete selectedItems[itemName];
          }

          updateUI();
        });
        selectedItemsDiv.appendChild(div);
      }

      totalPriceDiv.textContent = `€${totalPrice.toFixed(2)}`;
    }

    document.querySelectorAll('.reset-button').forEach(button => {
      button.addEventListener('click', function () {
        selectedItems = {};
        totalPrice = 0;
        updateUI();
      });
    });

    if ('addEventListener' in document) {
      document.addEventListener('DOMContentLoaded', function () {
        FastClick.attach(document.body);
      }, false);
    }
  </script>

</body>

</html>